<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–¯åŸºGPT - Telegramâ†’Payloadæµ‹è¯•</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            line-height: 1.6;
        }
        .container { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 12px;
            margin: 20px 0;
        }
        .status { 
            padding: 10px; 
            border-radius: 6px; 
            margin: 10px 0; 
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 6px; 
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        textarea { 
            width: 100%; 
            min-height: 150px; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 6px;
            font-family: monospace;
        }
        .endpoint { 
            background: #e9ecef; 
            padding: 8px 12px; 
            border-radius: 4px; 
            font-family: monospace;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>ğŸ“± æ–¯åŸºGPT - Telegramâ†’Payload æµ‹è¯•å·¥å…·</h1>
    
    <div class="container">
        <h2>ğŸ”— Webhook ç«¯ç‚¹</h2>
        <div class="endpoint" id="webhookUrl">
            https://siji-worker-v2.chengqiangshang.workers.dev/telegram-webhook
        </div>
        <button onclick="copyToClipboard('webhookUrl')">å¤åˆ¶é“¾æ¥</button>
        <button onclick="testWebhook()">æµ‹è¯•è¿æ¥</button>
    </div>

    <div class="container">
        <h2>ğŸ§ª æ¨¡æ‹Ÿ Telegram æ¶ˆæ¯æµ‹è¯•</h2>
        <textarea id="testMessage" placeholder="ç¼–è¾‘æµ‹è¯•æ¶ˆæ¯JSON...">{
  "message": {
    "message_id": 12345,
    "chat": {
      "id": -1001234567890,
      "type": "channel",
      "title": "æ–¯åŸºGPTæµ‹è¯•é¢‘é“"
    },
    "date": 1640995200,
    "text": "ğŸš€ æ–°AIçªç ´ï¼šGPT-5æ­£å¼å‘å¸ƒï¼\n\nOpenAIä»Šå¤©å®£å¸ƒäº†é©å‘½æ€§çš„GPT-5æ¨¡å‹ï¼Œåœ¨æ¨ç†ã€åˆ›é€ æ€§å’Œå¤šæ¨¡æ€ç†è§£æ–¹é¢å®ç°é‡å¤§çªç ´ã€‚\n\næ ¸å¿ƒäº®ç‚¹ï¼š\nâ€¢ æ¨ç†èƒ½åŠ›æå‡300%\nâ€¢ æ”¯æŒè§†é¢‘ã€éŸ³é¢‘ã€æ–‡æœ¬å¤šæ¨¡æ€\nâ€¢ å®æ—¶äº¤äº’å“åº”\nâ€¢ æ›´å¼ºçš„ä»£ç ç”Ÿæˆèƒ½åŠ›\n\nè¿™æ ‡å¿—ç€äººå·¥æ™ºèƒ½è¿›å…¥æ–°çš„å‘å±•é˜¶æ®µã€‚\n\n#GPT5 #OpenAI #äººå·¥æ™ºèƒ½ #æŠ€æœ¯çªç ´\n\nhttps://openai.com/gpt-5-announcement",
    "entities": [
      {"type": "hashtag", "offset": 150, "length": 5},
      {"type": "hashtag", "offset": 156, "length": 7},
      {"type": "hashtag", "offset": 164, "length": 5},
      {"type": "hashtag", "offset": 170, "length": 5},
      {"type": "url", "offset": 180, "length": 35}
    ]
  }
}</textarea>
        <br>
        <button onclick="sendTestMessage()" id="sendBtn">ğŸš€ å‘é€æµ‹è¯•æ¶ˆæ¯</button>
        <button onclick="loadPreset('news')">ğŸ“° æ–°é—»æ¨¡æ¿</button>
        <button onclick="loadPreset('tech')">ğŸ’» æŠ€æœ¯æ¨¡æ¿</button>
        <button onclick="loadPreset('ai')">ğŸ¤– AIæ¨¡æ¿</button>
    </div>

    <div class="container">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="result"></div>
    </div>

    <div class="container">
        <h2>âš™ï¸ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
        <button onclick="checkHealth()">ğŸ” æ£€æŸ¥å¥åº·çŠ¶æ€</button>
        <button onclick="checkRSSTest()">ğŸ“¡ æµ‹è¯•RSSèšåˆ</button>
        <div id="systemStatus"></div>
    </div>

    <script>
        async function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            await navigator.clipboard.writeText(text);
            showStatus('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }

        async function testWebhook() {
            try {
                const response = await fetch('/telegram-webhook', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: true })
                });
                
                if (response.ok) {
                    showStatus('âœ… Webhookè¿æ¥æ­£å¸¸', 'success');
                } else {
                    showStatus(`âš ï¸ Webhookå“åº”: ${response.status}`, 'info');
                }
            } catch (error) {
                showStatus(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function sendTestMessage() {
            const btn = document.getElementById('sendBtn');
            btn.disabled = true;
            btn.textContent = 'å‘é€ä¸­...';
            
            try {
                const message = JSON.parse(document.getElementById('testMessage').value);
                const response = await fetch('/telegram-webhook', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(message)
                });

                const result = await response.json();
                document.getElementById('result').innerHTML = `
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 6px; overflow-x: auto;">
${JSON.stringify(result, null, 2)}
                    </pre>
                `;
                
                if (result.success) {
                    showStatus('ğŸ‰ æ¶ˆæ¯å¤„ç†æˆåŠŸï¼', 'success');
                } else {
                    showStatus(`âš ï¸ å¤„ç†å¤±è´¥: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('result').innerHTML = `
                    <div class="error">é”™è¯¯: ${error.message}</div>
                `;
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸš€ å‘é€æµ‹è¯•æ¶ˆæ¯';
            }
        }

        async function checkHealth() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                document.getElementById('systemStatus').innerHTML = `
                    <div class="success">
                        <strong>âœ… ç³»ç»Ÿå¥åº·çŠ¶æ€</strong><br>
                        æœåŠ¡: ${data.service}<br>
                        ç‰ˆæœ¬: ${data.version}<br>
                        AIæä¾›å•†: ${data.provider}<br>
                        RSSç­–ç•¥: ${data.rss_strategy}<br>
                        æ—¶é—´: ${data.timestamp}
                    </div>
                `;
            } catch (error) {
                document.getElementById('systemStatus').innerHTML = `
                    <div class="error">âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}</div>
                `;
            }
        }

        async function checkRSSTest() {
            showStatus('ğŸ”„ æ­£åœ¨æµ‹è¯•RSSèšåˆ...', 'info');
            try {
                const response = await fetch('/test', { method: 'POST' });
                const data = await response.json();
                document.getElementById('systemStatus').innerHTML = `
                    <div class="info">
                        <strong>ğŸ“¡ RSSæµ‹è¯•ç»“æœ</strong><br>
                        å¤„ç†æ–‡ç« : ${data.count} ç¯‡<br>
                        å‘å¸ƒæ–‡ç« : ${data.published} ç¯‡<br>
                        AIæä¾›å•†: ${data.provider}<br>
                        æ‰§è¡Œæ—¥å¿—: ${data.logs ? data.logs.length : 0} æ¡
                    </div>
                `;
                showStatus('âœ… RSSæµ‹è¯•å®Œæˆ', 'success');
            } catch (error) {
                showStatus(`âŒ RSSæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function loadPreset(type) {
            const presets = {
                news: {
                    text: "ğŸ“° é‡å¤§ç§‘æŠ€æ–°é—»ï¼šè‹¹æœå‘å¸ƒAIèŠ¯ç‰‡\n\nè‹¹æœå…¬å¸ä»Šæ—¥æ­£å¼å‘å¸ƒäº†ä¸“ä¸ºAIè®¡ç®—è®¾è®¡çš„M3 UltraèŠ¯ç‰‡ï¼Œæ€§èƒ½è¾ƒä¸Šä¸€ä»£æå‡40%ã€‚\n\nå…³é”®ç‰¹æ€§ï¼š\nâ€¢ ç¥ç»ç½‘ç»œå¼•æ“æ€§èƒ½ç¿»å€\nâ€¢ æ”¯æŒç«¯åˆ°ç«¯AIæ¨ç†\nâ€¢ åŠŸè€—é™ä½25%\n\n#Apple #AIèŠ¯ç‰‡ #M3Ultra #ç§‘æŠ€æ–°é—»\n\nhttps://apple.com/m3-ultra"
                },
                tech: {
                    text: "ğŸ’» å¼€å‘è€…ç¦éŸ³ï¼šæ–°æ¡†æ¶å‘å¸ƒ\n\nNext.js 14æ­£å¼å‘å¸ƒï¼Œå¸¦æ¥äº†æœåŠ¡å™¨ç»„ä»¶å’Œè¾¹ç¼˜è¿è¡Œæ—¶çš„é‡å¤§æ”¹è¿›ã€‚\n\næ–°ç‰¹æ€§ï¼š\nâ€¢ æœåŠ¡å™¨ç»„ä»¶ç¨³å®šç‰ˆ\nâ€¢ Turbopackæ€§èƒ½æå‡\nâ€¢ æ”¹è¿›çš„å¼€å‘ä½“éªŒ\n\n#NextJS #React #å‰ç«¯å¼€å‘ #JavaScript\n\nhttps://nextjs.org/blog/next-14"
                },
                ai: {
                    text: "ğŸ¤– AIé¢†åŸŸçªç ´ï¼šå¤šæ¨¡æ€å¤§æ¨¡å‹\n\nGoogle DeepMindå‘å¸ƒäº†Gemini Pro Visionï¼Œå®ç°äº†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘çš„ç»Ÿä¸€ç†è§£ã€‚\n\næŠ€æœ¯äº®ç‚¹ï¼š\nâ€¢ å¤šæ¨¡æ€èåˆç†è§£\nâ€¢ å®æ—¶è§†è§‰é—®ç­”\nâ€¢ ä»£ç ç”Ÿæˆèƒ½åŠ›å¢å¼º\n\nè¿™ä¸ºAIåº”ç”¨å¼€è¾Ÿäº†æ–°çš„å¯èƒ½æ€§ã€‚\n\n#Gemini #DeepMind #å¤šæ¨¡æ€AI #æœºå™¨å­¦ä¹ \n\nhttps://deepmind.google/gemini"
                }
            };

            if (presets[type]) {
                const template = {
                    message: {
                        message_id: Math.floor(Math.random() * 100000),
                        chat: {
                            id: -1001234567890,
                            type: "channel",
                            title: "æ–¯åŸºGPTæµ‹è¯•é¢‘é“"
                        },
                        date: Math.floor(Date.now() / 1000),
                        text: presets[type].text
                    }
                };
                document.getElementById('testMessage').value = JSON.stringify(template, null, 2);
                showStatus(`ğŸ“ å·²åŠ è½½${type === 'news' ? 'æ–°é—»' : type === 'tech' ? 'æŠ€æœ¯' : 'AI'}æ¨¡æ¿`, 'info');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            
            setTimeout(() => {
                statusDiv.remove();
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.addEventListener('load', checkHealth);
    </script>
</body>
</html>